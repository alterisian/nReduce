- relationship ||= nil
.relationship
  - form_id = "relationship_#{connected_with.obj_str}"
  %div{:id => "#{form_id}_details"}
    - if (!relationship.blank? and relationship.approved?) #|| entity.connected_to?(connected_with)
      - if !relationship.blank?
        = link_to '<i class="icon icon-remove"></i> Remove from Group'.html_safe, reject_relationship_path(:id => relationship.id), :method => :post, :class => 'btn', :confirm => "Are you sure you want to remove #{connected_with.name} as a connection?", :remote => true
      - else
        = link_to 'View Profile', connected_with, :class => 'btn btn-large', :style => 'margin-bottom: 12px'
    - elsif !relationship.blank? and relationship.pending?
      / This is the person being requested
      - if relationship.connected_with == entity
        = link_to '<i class="icon-remove"></i> Ignore'.html_safe, reject_relationship_path(relationship), :class => 'btn btn-large', :method => :post, :remote => true
        &nbsp;&nbsp;
        = link_to '<i class="icon-ok icon-white"></i> Approve Request'.html_safe, approve_relationship_path(relationship), :class => 'btn btn-large btn-success', :method => :post, :remote => true
      - else # This is the person who initiated
        = link_to '<i class="icon-remove"></i> Cancel Request'.html_safe, reject_relationship_path(relationship), :class => 'btn btn-large', :method => :post, :remote => true
    - elsif !relationship.blank? and relationship.suggested?
      /= link_to '<i class="icon-refresh"></i> Pass'.html_safe, reject_relationship_path(relationship), :class => 'btn btn-large', :method => :post
      /&nbsp;&nbsp;
      = link_to '<i class="icon-ok icon-white"></i> Invite to Group'.html_safe, '#', :onclick => "$('##{form_id}').modal(); return false;", :class => 'btn btn-large btn-success'
    - elsif user_signed_in? # and Relationship.can_connect?(entity, connected_with)
      = link_to((connected_with.is_a?(Startup) ? 'Invite to Group' : 'Connect'), '#', :onclick => "$('##{form_id}').modal(); return false;", :class => 'btn btn-large btn-info')
    - relationship ||= Relationship.new(:entity => entity, :connected_with => connected_with)
    / Clear out message if it's a suggested relationship
    - relationship.message = nil if relationship && relationship.suggested?
  .modal.relationship_request.hide{:id => form_id, :align => 'left'}
    .modal-header
      %button.close{:type => 'button', 'data-dismiss' => 'modal'} x
      %h3 Connect with #{connected_with.name}
    .modal-body
      = form_for relationship, :url => (relationship.new_record? ? {:controller => :relationships, :action => :create} : approve_relationship_path(relationship)), :remote => true, :html => {:id => form_id, :class => 'form-horizontal', :method => :post} do |f|
        = f.hidden_field :entity_id
        = f.hidden_field :entity_type
        = f.hidden_field :connected_with_id
        = f.hidden_field :connected_with_type
        - unless relationship.context.blank?
          = hidden_field_tag 'relationship[context]', relationship.context.to_s
        %p Please write a quick message to explain why you think they would be a great match for your startup?
        = f.text_area :message, :size => '120x5', :class => 'span4'
        %br/
        %br/
        = f.submit (connected_with.is_a?(Startup) ? 'Invite to Group' : 'Connect'), :class => 'btn btn-info btn-large'